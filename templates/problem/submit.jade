extends base
- load staticfiles
- load i18n
- load compress

block js_media
    if has_select2
        script(type='text/javascript', src='{{ SELECT2_JS_URL }}')
    script(type='text/javascript', src='{{ ACE_URL }}/ace.js')
    - compress js
        | #{form.media.js}
        script(type='text/javascript').
            $(function () {
                function format(state) {
                    if (!state.id) return state.text; // optgroup
                    return state.text;
                }

                function formatSelection(state) {
                    if (!state.id) return state.text; // optgroup
                    return state.text + " (" + $("option[data-id=" + state.id + "]").attr('data-judge-info') + ")";
                }

                $("#language-expand").select2({
                    templateResult: format,
                    templateSelection: formatSelection,
                    escapeMarkup: function (m) {
                        return m;
                    }
                });
            });

block media
    if has_select2
        link(href="{{ SELECT2_CSS_URL }}", type="text/css", media="screen", rel="stylesheet")
    - compress css
        | #{form.media.css}
        style(media='screen').
            #submit-wrapper {
                margin-top: 0.7em;
            }

            #submit-wrapper #problem-id, #submit-wrapper #editor, #submit-wrapper #language {
                margin-top: 4px;
            }

            #language-expand { width: 100%; }

            .select2-results__option {
                color: #757575 !important;
                background: white !important;
            }

            .select2-results__option--highlighted {
                text-decoration: underline;
            }

            .select2-results__option[aria-selected=true] {
                font-weight: bold;
                color: black !important;
            }

            .select2-results__option {
                padding: 4px 0px;
            }

            .select2-results__options {
                overflow-y: visible !important;
            }

            .select2-results__option {
                break-inside: avoid-column;
            }

            .select2-results {
                -webkit-columns: 10 7em;
                -moz-columns: 10 7em;
                columns: 10 7em;
                padding-left: 1.5em;
                padding-bottom: 0.5em;
            }


block body
    br
    form#problem_submit.form-area(style='width:100%;box-sizing:border-box', action='', method='post')
        - csrf_token
        | #{form.non_field_errors}
        #submit-wrapper
            #problem-id
                | #{form.problem.errors}
                | #{form.problem}
            #editor
                | #{form.source.errors}
                | #{form.source}
            if not no_judges
                #language
                    | #{form.language.errors}
                    | #{form.language}
                    #language-select
                        #language-current
                            .data
                                span.name
                                span.info
                            .fa.language-drop
                        select#language-expand: each lang in form.fields.language.queryset
                            - var runtime_versions = lang.runtime_versions
                            option(value=lang.id, data-id=lang.id, data-name=lang.name, data-info=lang.info,
                               data-judge-info='{% include "runtime_version_fragment.jade" %}',
                               data-ace=lang.ace)= lang.name
        hr
        if no_judges
            span(style='color: red') {% trans "No judge is available for this problem." %}
        else
            input(class="button", style="float:right;padding:6px 12px", type='submit', value='{% trans "Submit!" %}')

extends common-content

-load staticfiles
-load markdown_trois_tags
-load cache
-load timedelta
-load smart_math
-load social_share
-load camo_proxy

block content_js_media
    script(type='text/javascript').
        $(document).ready(function () {
            $('.time-remaining').each(function () {
                count_down($(this));
            });
        });
    include comments/js_media

block content_media
    style.
        .info-float .fa {
            color: #000;
        }

    include comments/media

block info_float
    if contest.can_join or participating
        if not participating or not participation.ended
            if in_contest
                a.unselectable.button.full(href='{% url "contest_leave" contest.key %}') Leave contest
            else
                a.unselectable.button.full(href='{% url "contest_join" contest.key %}') Join contest
            hr

    if contest.start_time <= now or perms.judge.see_private_contest
        a(href='{% url "contest_ranking" contest.key %}')
            | View rankings
        hr

    if perms.judge.change_contest
        a(href='{% url "admin:judge_contest_change" contest.id %}')
            | Edit contest
        hr
    br

    i.fa.fa-clock-o.fa-fw
    if contest.start_time > now
        b Starting in:
        .time-remaining #{contest.time_before_start|timedelta:"simple"}
    elif participating
        if participation.ended
            b Time is up!
        else
            b Time remaining:
            = ' '
            .time-remaining #{participation.time_remaining|timedelta:"simple"}
    elif contest.end_time < now
        b Contest is over.
    else
        if contest.time_limit
            b Can join until:
        else
            b Time remaining:
        = ' '
        .time-remaining #{contest.time_before_end|timedelta:"simple"}

block description
    if contest.start_time > now
        #banner(style='border-bottom: 1px solid rgba(0, 0, 0, 0.2); padding-bottom: 1em;')
            div(style='margin: 0.5em 0px;')
                a.time-remaining(style='display: block; text-decoration: none; text-align: center; line-height: 1.3; font-size: 2.3em; padding-bottom: 0.1em;', href='#') #{contest.time_before_start|timedelta:"simple"}
                #time(style='text-align: center; display: block; color: rgb(85, 85, 85);')
                    if contest.time_limit
                        b #{contest.time_limit|timedelta:"simple-no-seconds"}
                        |  window from 
                        b #{contest.start_time|date:"M j, Y, G:i"}
                        |  to 
                        b #{contest.end_time|date:"M j, Y, G:i"}
                    else
                        b #{contest.contest_window_length|timedelta:"simple-no-seconds"}
                        | long starting on
                        b #{contest.start_time|date:"M j, Y, G:i"}              
    
    - cache 3600 contest_html contest.id
        | #{contest.description|markdown:"contest"|smart_math|proxy_images}

block comments
    span.social
       - post_to_gplus post "<i class=\"fa fa-google-plus-square\"></i>"
       - post_to_facebook post "<i class=\"fa fa-facebook-official\"></i>"
       - post_to_twitter "{{ SITE_NAME }}:" post "<i class=\"fa fa-twitter\"></i>"
    .comment-area
        h2 Comments
        include comments/list

block bodyend
    | #{block.super}
    include comments/math
